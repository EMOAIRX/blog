<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>博弈论与强化学习の期中复习 | emoairx</title>
  <meta name="description" content="对不起，学得很失败，基础知识没掌握，没有理解公式，没有掌握思想，没有深入内核。 博弈论Restart：有一说一的感觉就是政管的那门通识课讲到的内容可能还是少了点，这门课我还是没咋听懂就是说，以前还退过一门算法博弈论，那门课根本不敢学笑死。 ok，假设大家已经被科普过了解了什么是博弈论， 彻底躺平的一学期与最后一周的博弈论 | emoairx 合作博弈、非合作博弈；完全信息、不完全信息；静态博弈、">
<meta property="og:type" content="article">
<meta property="og:title" content="博弈论与强化学习の期中复习">
<meta property="og:url" content="http://emoairx.github.io/blog/2024/05/04/note%20on%20multiAgent/index.html">
<meta property="og:site_name" content="Emoairx">
<meta property="og:description" content="对不起，学得很失败，基础知识没掌握，没有理解公式，没有掌握思想，没有深入内核。 博弈论Restart：有一说一的感觉就是政管的那门通识课讲到的内容可能还是少了点，这门课我还是没咋听懂就是说，以前还退过一门算法博弈论，那门课根本不敢学笑死。 ok，假设大家已经被科普过了解了什么是博弈论， 彻底躺平的一学期与最后一周的博弈论 | emoairx 合作博弈、非合作博弈；完全信息、不完全信息；静态博弈、">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-05-04T06:06:39.074Z">
<meta property="article:modified_time" content="2024-05-07T14:02:34.899Z">
<meta property="article:author" content="emoairx">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="博弈论">
<meta property="article:tag" content="强化学习">
<meta name="twitter:card" content="summary">
  <!-- Canonical links -->
  <link rel="canonical" href="http://emoairx.github.io/blog/2024/05/04/note%20on%20multiAgent/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Emoairx" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
  
  
  
<meta name="generator" content="Hexo 5.4.0"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="" target="_blank">
          <img class="img-circle img-rotate" src="/blog/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">emoairx</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">PKU,EECS</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Beijing, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/blog/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/blog/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/blog/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-pkuinfo">
          <a href="/blog/info">
            
            <i class="icon "></i>
            
            <span class="menu-title">menu.PKUinfo</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/emoairx" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>只是一些简单的生活分享吧</p>
            </div>
        </div>
    </div>
</div>

    
      

    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ICS/" rel="tag">ICS</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/TCS%E5%9F%BA%E7%A1%80/" rel="tag">TCS基础</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E4%BD%9C%E4%B8%9A/" rel="tag">作业</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%87%B8%E4%BC%98%E5%8C%96/" rel="tag">凸优化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" rel="tag">博弈论</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%9C%B0%E6%A6%82/" rel="tag">地概</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" rel="tag">强化学习</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%97%A5%E8%AE%B0/" rel="tag">日记</a><span class="tag-list-count">80</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E6%B8%B8%E8%AE%B0/" rel="tag">游记</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%A8%8B%E8%AE%BE/" rel="tag">程设</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a><span class="tag-list-count">17</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%AE%97%E5%88%86/" rel="tag">算分</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E7%BB%8F%E5%8E%9F/" rel="tag">经原</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%9A%8F%E7%AC%94/" rel="tag">随笔</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/%E9%9F%B3%E6%95%B0/" rel="tag">音数</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/blog/tags/ICS/" style="font-size: 13.25px;">ICS</a> <a href="/blog/tags/TCS%E5%9F%BA%E7%A1%80/" style="font-size: 13px;">TCS基础</a> <a href="/blog/tags/%E4%BD%9C%E4%B8%9A/" style="font-size: 13.25px;">作业</a> <a href="/blog/tags/%E5%87%B8%E4%BC%98%E5%8C%96/" style="font-size: 13px;">凸优化</a> <a href="/blog/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" style="font-size: 13.25px;">博弈论</a> <a href="/blog/tags/%E5%9C%B0%E6%A6%82/" style="font-size: 13px;">地概</a> <a href="/blog/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" style="font-size: 13px;">强化学习</a> <a href="/blog/tags/%E6%97%A5%E8%AE%B0/" style="font-size: 14px;">日记</a> <a href="/blog/tags/%E6%B8%B8%E8%AE%B0/" style="font-size: 13.5px;">游记</a> <a href="/blog/tags/%E7%A8%8B%E8%AE%BE/" style="font-size: 13.25px;">程设</a> <a href="/blog/tags/%E7%AC%94%E8%AE%B0/" style="font-size: 13.75px;">笔记</a> <a href="/blog/tags/%E7%AE%97%E5%88%86/" style="font-size: 13px;">算分</a> <a href="/blog/tags/%E7%BB%8F%E5%8E%9F/" style="font-size: 13px;">经原</a> <a href="/blog/tags/%E9%9A%8F%E7%AC%94/" style="font-size: 13.5px;">随笔</a> <a href="/blog/tags/%E9%9F%B3%E6%95%B0/" style="font-size: 13px;">音数</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/05/">May 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/04/">April 2024</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/02/">February 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2024/01/">January 2024</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/12/">December 2023</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/10/">October 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/08/">August 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/07/">July 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/05/">May 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/04/">April 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/03/">March 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/02/">February 2023</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/01/">January 2023</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/12/">December 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/11/">November 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/10/">October 2022</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/09/">September 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/08/">August 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/07/">July 2022</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/06/">June 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/05/">May 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/04/">April 2022</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/03/">March 2022</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2022/01/">January 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2021/11/">November 2021</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/blog/2024/05/04/diary/diary240504/" class="title">240504</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-04T06:21:48.056Z" itemprop="datePublished">2024-05-04</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/blog/2024/05/04/note%20on%20multiAgent/" class="title">博弈论与强化学习の期中复习</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-04T06:06:39.074Z" itemprop="datePublished">2024-05-04</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/blog/2024/05/01/diary/diary240501/" class="title">240501</a>
              </p>
              <p class="item-date">
                <time datetime="2024-05-01T15:49:28.167Z" itemprop="datePublished">2024-05-01</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/blog/2024/04/27/Majorization%20Minimization/" class="title">Majorization Minimization</a>
              </p>
              <p class="item-date">
                <time datetime="2024-04-26T16:08:44.712Z" itemprop="datePublished">2024-04-27</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/blog/2024/04/26/typedown/" class="title">some meaningless words</a>
              </p>
              <p class="item-date">
                <time datetime="2024-04-26T10:54:10.482Z" itemprop="datePublished">2024-04-26</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<main class="main" role="main">
  <div class="content">
  <article id="post-note on multiAgent" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      博弈论与强化学习の期中复习
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/blog/2024/05/04/note%20on%20multiAgent/" class="article-date">
	  <time datetime="2024-05-04T06:06:39.074Z" itemprop="datePublished">2024-05-04</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/blog/tags/%E5%8D%9A%E5%BC%88%E8%AE%BA/" rel="tag">博弈论</a>, <a class="article-tag-link-link" href="/blog/tags/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0/" rel="tag">强化学习</a>, <a class="article-tag-link-link" href="/blog/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a>
  </span>


        

	<span class="article-read hidden-xs">
    	<i class="icon icon-eye-fill" aria-hidden="true"></i>
    	<span id="/blog/2024/05/04/note%20on%20multiAgent/" class="leancloud_visitors"  data-flag-title="博弈论与强化学习の期中复习">
			<span class="leancloud-visitors-count">0</span>
		</span>
    </span>

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/blog/2024/05/04/note%20on%20multiAgent/#comments" class="article-comment-link">Comments</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <hr>
<p>对不起，学得很失败，基础知识没掌握，没有理解公式，没有掌握思想，没有深入内核。</p>
<h4 id="博弈论Restart："><a href="#博弈论Restart：" class="headerlink" title="博弈论Restart："></a>博弈论Restart：</h4><p>有一说一的感觉就是政管的那门通识课讲到的内容可能还是少了点，这门课我还是没咋听懂就是说，以前还退过一门算法博弈论，那门课根本不敢学笑死。</p>
<p>ok，假设大家已经被科普过了解了什么是博弈论，</p>
<p><a href="https://emoairx.github.io/blog/2023/12/20/last game/">彻底躺平的一学期与最后一周的博弈论 | emoairx</a></p>
<p>合作博弈、非合作博弈；完全信息、不完全信息；静态博弈、动态博弈</p>
<p>每个参与者对<strong>自己的行为</strong>，其它<strong>参与者的行为</strong>都是有预期的，根据预期做出合乎<strong>理性</strong>的行动。</p>
<p>我们还是从最简单的地方开始回顾。完全信息静态博弈，什么是完全呢。</p>
<p><strong>完全信息：</strong>每一参与者的策略集和收益函数均为共同知识。</p>
<p>后面会说到<strong>完美信息</strong>并不是完全信息，完美信息大概是说历史上的事件都被记录了下来。</p>
<p><strong>Nash equilibrium</strong></p>
<p>根据定义，就是有一个策略组合，对于任何一个人要大于等于它改变的情况下收益函数。形式化为</p>
<script type="math/tex; mode=display">
v_i(\sigma_i^*,\sigma_{-i}^*) \ge v_i(\sigma_i,\sigma_{-i}^*)</script><p>这里可能要记一下下标 $-i$ 应该可以用来表示对手策略。</p>
<p><strong>Support</strong>：因变量是一个策略，返回那些概率大于零的部分。</p>
<p>最佳应对引理的结论是，for any nash equilibrum，对于一个人来说，支撑集的每一个纯策略都是一个best response.</p>
<p>于是就引出一些求解方法</p>
<h4 id="求解nash均衡"><a href="#求解nash均衡" class="headerlink" title="求解nash均衡"></a>求解nash均衡</h4><ol>
<li><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/436477063">两人有限博弈的均衡计算 - 知乎 (zhihu.com)</a></p>
</li>
<li><p>支撑法求解，构造除所有混合策略的支撑之后根据best response来解方程。</p>
<p>枚举支撑法的问题包括（解不存在，不满足非负性条件，存在支撑策略小于<strong>非支撑</strong>策略期望收益的情况）</p>
</li>
<li><p>规划求解法（比如双人博弈），有四个，一是在均衡下参与人1采用任何纯策略都不高于均衡收益；二是和为一；三是大于等于零；四是最大化收益减均衡收益。</p>
</li>
</ol>
<h5 id="Lemke-Howson"><a href="#Lemke-Howson" class="headerlink" title="Lemke-Howson"></a>Lemke-Howson</h5><ul>
<li>把所有小于等于变成等于，利用松弛变量。<ul>
<li>如果一个action存在，即 $x^j&gt;0$，那么一定有它是关于对手策略的 best response，也即 $r^j=0$。</li>
</ul>
</li>
<li>把原约束 $x^TB\le u\cdot 1,1^Tx=1$ 变成约束 $x^T\bar B \le 1$，通过某种矩阵的映射。</li>
<li>于是说在这个约束可行解的多面体里，每个纯策略要么概率是零，要么就是对手策略的best response.<ul>
<li>那么对于每一个综合了双方的action，考虑它满足的条件的数量，就要尽可能满足所有这些条件都要满足。定义这些条件为<strong>标签</strong>，一个点 $x$ 满足的标签的集合为 $L(x)$</li>
</ul>
</li>
<li>于是转而得出，如果 $(x,y)$ 是一个Nash equilibrium，就有 $L(x)\cup L(y)=M+N$，定义这个性质叫做<strong>完备的</strong>。<ul>
<li>注意 $L(x)={i\mid x_i=0} \cup {j\mid (x^TB)_j=1}$</li>
<li>所以两个图其实是相互的，有了 $y$ 才可能判断前 $n$ 个点是否满足要么是best response要么是等于零。</li>
</ul>
</li>
<li>定义一张图，图上两个点右边如果这两个点在符合条件的多面体上是相邻的。有一些点是完备的，零点和Nash均衡点。</li>
<li>关于一个性质（标签）$k$，定义这张图的一个子图 $U_k$，那些要么只缺少标签 $k$，要么什么标签都不缺少。<strong>完备的点在这张图上的度为1，其余（可达）的点度为2。</strong><ul>
<li><a target="_blank" rel="noopener" href="https://web.stanford.edu/~saberi/lecture4.pdf">lecture4.pdf (stanford.edu)</a> 的 <strong>theorem4</strong></li>
<li>对于零这个点来说，只可能把标签换成选一个元素；对于nash均衡来说，也只可能舍弃掉 $k$ 这个位置。</li>
<li>对于其它的一般的点，因为我们选的一定是顶点，所以总的可重集的大小是 $N+M$ 的，也就是说一定有一个重复的部分为 $l$。在两张图的地方分别舍弃 $l$ 就能到达两个地方。</li>
</ul>
</li>
<li>算法的过程是：不断地舍弃掉那些度为2的点，每次drop一个，pick一个。<ul>
<li>Traversing the whole graph G to add missing labels and drop duplicate labels (i.e. pivoting) until we find one set of nodes that are fully labelled.</li>
<li><strong>Guarantee to find one Nash</strong>, but not all of them! Determining whether all Nash are found is not even NP. </li>
<li>Exponential time complexity because G has the number of vertices that is exponential in $n,m$ (combinatorial many) </li>
<li>Because LCP has no objective, we cannot tell the progress before finding a solution. </li>
<li>Corollary: almost all games have an odd number of Nash equilibrium.</li>
</ul>
</li>
<li>Algorithm：<ul>
<li>Choose $k \in M \cup N$</li>
<li>Start with $(x,y) = (0,0) \in G$, Drop label $k$ from $(x,y)$.</li>
<li>Let $(x,y)$ be the current vertex. Let $l$ be the label that is picked up by dropping label $k$, just drop $l$ <strong>in other polytope</strong> and repeat until find the nash equilibirum.</li>
</ul>
</li>
</ul>
<h5 id="零和博弈"><a href="#零和博弈" class="headerlink" title="零和博弈"></a>零和博弈</h5><ul>
<li><p>定义<strong>博弈的值</strong>是一个常数 $v$，在参与人1在均衡中得到的期望收益。</p>
</li>
<li><p>如果博弈的值大于零，那么纳什均衡就是一个对偶线性规划的解：</p>
</li>
<li><script type="math/tex; mode=display">
\begin{align*}
&\min \sum p_i\\
s.t. &\sum  a_{ij}p_i \ge 1\\
&p_i \ge 0
\end{align*}</script></li>
<li><p>其中 $v=\frac{1}{\sum_{}p_i}$，这个问题的对偶问题就是一个对手（玩家2）要最大化收益。其中最终的概率是归一化后的这个。</p>
</li>
</ul>
<p>对于nash均衡的求解，当<strong>参与人数大于2时</strong>，没有得到很好的解决，很多都是非线性的。</p>
<h4 id="nash均衡存在性"><a href="#nash均衡存在性" class="headerlink" title="nash均衡存在性"></a>nash均衡存在性</h4><ul>
<li><p>其实可以参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/454822666">纳什均衡的存在性证明 - 知乎 (zhihu.com)</a></p>
</li>
<li><p><strong>Sperner’s Lemma</strong> ：按照某种情况染色，只可能有奇数个顶点颜色不同的三角形。</p>
<ul>
<li>其实比较好理解，就是每个点都染色之后，只能走红黄的边。那么除了最最下角的起点以外，它能恰好走到一个三个点不同色的三角形，其它都是一系列的三角形走到三角形。</li>
</ul>
</li>
<li><p>然后是关于推广的，<strong>Brouwer’s lemma</strong>：对于 $X \to X$ 的连续函数存在不动点。<strong>107</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ap4y1D71s">https://www.bilibili.com/video/BV1Ap4y1D71s</a></li>
<li>具体方法是，首先构造一个平面，然后对于 $R^3$ 中的点，设 $f(x)=y$</li>
<li>那么根据 $\min_i y_i&lt;x_i$ 的那个 $i$ 来给点染色，从而出现三种颜色。（其实依然不是很理解）。也就是其实在这个定义域（一个单纯性）内，我是能找到一个不动点的。然后后来我们又把结论扩展了。</li>
</ul>
</li>
<li><p>然后用这个lemma来证明nash均衡的存在性，其实就是考虑怎么构造出这样一个函数，这个函数是一个映射。直观地理解是这个函数应该是一个best response相关的，因为nash均衡具有best response不变性。</p>
</li>
<li><p>所以我们考虑所有策略 $k$，定义参与人改变策略的倾向为</p>
<script type="math/tex; mode=display">
\phi_{ik}(\sigma)=\max(0,v_{ik}(\sigma)-v_i(\sigma))</script><p>具体而言是如果参与人 $i$ 采取了纯策略 $s_{ik}$ 后的收益比现在的策略大多少。</p>
<p>$f(\sigma)=\sigma’$，其中</p>
<script type="math/tex; mode=display">
\sigma'_i(s_{ik}) = \frac{\sigma_{i}(s_{ik})+\phi_{ik}(\sigma)}{\sum_j \sigma_{i}(s_{ij})+\phi_{ij}(\sigma)}</script><p>直观地理解，方法就是当前策略为 $\sigma$，那么我对这个点我可以得到一个各个方向的best response的归一化。总之存在一个 $f$ 不变的地方。也就是基本上都有奇数个nash均衡。</p>
</li>
</ul>
<p><strong>Nash逼近</strong></p>
<ul>
<li>但注意到我们只是说明了存在性。所以其实要求解这个逼近有两种方法</li>
<li>一种是weak的，具体是 $||F(x’)-x’|| &lt; \epsilon$，一种是strong的，为 $||x’-x^*|| &lt; \epsilon$</li>
</ul>
<p>后面引出了一个复杂度类称之为<strong>PPAD</strong>，关于二人博弈，四人以上博弈，多人一般和随机博弈，nash均衡的计算式PPAD-Complete的。</p>
<h5 id="PPAD"><a href="#PPAD" class="headerlink" title="PPAD"></a>PPAD</h5><ul>
<li><p>polynomial parity arguments on directed graphs，有向图的多项式校验参数</p>
</li>
<li><blockquote>
<p>计算纳什均衡本质是一个搜索的问题，需要新的复杂度理论来 刻画，也就是FNP类</p>
<p>TFNP是FNP的子类，表示问题一定有解。PPA是TFNP的子类， 表示无向图问题，+d表示有向图，就是PPAD。</p>
<p>Nash → Brouwer → Sperner → End of Line → Nash 可以规约</p>
</blockquote>
</li>
<li><p>一类PPAD完全的问题是：End of The Line，大概是每个点都有一个唯一的出度，但是要从起始点开始找到一个结束的无出度的点。不过没搞懂这里的问题规模是什么。</p>
</li>
</ul>
<p>nash均衡的<strong>多重性</strong></p>
<ul>
<li><p>有时候有多个nash均衡的解，比如多个纯均衡的解。一般的解决思路有两种</p>
<ul>
<li>均衡精炼：剔除不合理的均衡，如子博弈精炼那什均衡，精炼贝叶斯nash均衡等</li>
<li>非规范式方法：焦点效应、廉价磋商、相关均衡。</li>
</ul>
</li>
<li><p>焦点效应：考虑一些被模型所抽象掉的信息</p>
<ul>
<li>廉价磋商的一种定义可能是，根据对手提出的建议选择接受或者不接受，并在这种setting下找到新的nash均衡。带有沟通过程</li>
</ul>
</li>
<li><p>相关均衡：</p>
<ul>
<li>再引入一个随机变量，假设有 $m$ 种取值，双方对该随机变量不同取值下的反应不同，最终得到一个相关的矩阵，如果是两个人的话，这个矩阵是三维的，这里双方的策略有 $k^m$ 种，长度为 $m$。</li>
<li>所谓的相关均衡，就是在各种概率的取值的情况下，<strong>期望上</strong>的收益最终能达到的nash均衡。双方收到的信号可以相关但是不同。</li>
</ul>
</li>
</ul>
<h4 id="扩展式博弈"><a href="#扩展式博弈" class="headerlink" title="扩展式博弈"></a>扩展式博弈</h4><ul>
<li><p>大概就是引入了一个信息集的概念，一个人是否知道在哪个节点上，于是所有参与者在每个信息集上的行动 $A_i(I_i)$ 的笛卡尔积 $S_i$ 表示 参与人的策略集。静态博弈也可以扩展式表示。</p>
</li>
<li><p>在之前的通识课里我们已经知道了子博弈精炼纳什均衡（剔除一些不合理的nash均衡）及其求解（和动态规划差不多），我们这里重点关注子博弈精炼纳什均衡的合理性与唯一性。</p>
</li>
<li><p>Kuhn定理：在<strong>perfect recall</strong>的前提下，每一个混合策略都有一个行为策略和他等价。</p>
</li>
<li><blockquote>
<p>不仅要求在博弈达到的路径上参与人的选择最优，而且要求在博弈<strong>没有达到的路径</strong>上参与人的选择也要最优。</p>
</blockquote>
</li>
<li><p>关于合理性，虽然逆向归纳法在逻辑上是合理的，但是在蜈蚣博弈等情形下往往与常识相违背。</p>
</li>
<li><p>关于唯一性，如果不存在一个人在某个决策节点时其不同选择对自己的收益是无差异的，那么就是唯一的子博弈精炼nash均衡。</p>
</li>
</ul>
<h5 id="贝叶斯博弈"><a href="#贝叶斯博弈" class="headerlink" title="贝叶斯博弈"></a>贝叶斯博弈</h5><ul>
<li>贝叶斯的意思我理解成就是根据观测和先验概率，得到后验概率。</li>
<li>对于存在非完全信息的情况，设置一个自然的存在（海萨尼转换），所有参与者关于自然的行动的<strong>信念</strong>是相同的，且为共同知识。</li>
<li>在这个转换中有一个很有意思的点：参与人对包括自己在内的所有参与人的类型的联合概率推断(分布)都是一样的，但由于<strong>参与人掌握的私人信息不同</strong>，使得各自对其他参与人的类型的<strong>概率分布的推断不同</strong>。从贝叶斯公式可以看出来是这样的。</li>
<li>那么贝叶斯博弈要求最关键的要素是：<ul>
<li>参与人的集合</li>
<li>参与人的<strong>类型集</strong></li>
<li>参与人关于其它参与人的类型的<strong>推断</strong></li>
<li>参与人类型集相应的行动集</li>
<li>参与人类型集相应的收益函数</li>
</ul>
</li>
<li>通过海萨尼转换后，得到了一个信息完全但非完美的动态博弈问题，则由于对自然的概率有一致的判断，则根据这个概率能得到均衡。</li>
</ul>
<h5 id="贝叶斯博弈-1"><a href="#贝叶斯博弈-1" class="headerlink" title="贝叶斯博弈"></a>贝叶斯博弈</h5><p><strong>这里我没看懂</strong></p>
<hr>
<h4 id="合作博弈"><a href="#合作博弈" class="headerlink" title="合作博弈"></a>合作博弈</h4><ul>
<li>合作博弈就是说可以有一些人一起合作然后分钱，主要考虑参与人之间能达成的<strong>可实施(enforceable)</strong>的<strong>协议</strong>。强调集体理性。在这种情况下，合作是博弈规则的一部分，而非博弈的结果。</li>
<li>因为可实施，合作后收益增加的部分叫做<strong>合作剩余(cooperative surplus)</strong></li>
<li><strong>特征函数</strong>：$V:2^N \to R$，通过合作取得的联盟总体收益水平。<ul>
<li>超加性：对于任意独立的 $S,T$ , $V(S\cup T) \ge V(S)+V(T)$（否则联盟会解散）</li>
<li>单调性：联盟越大，合作所获越大；$V(S)\le V(T)$ 如果 $S \subseteq T$</li>
</ul>
</li>
<li>合作博弈是<strong>本质(essential)</strong>的如果存在有净增收益的联盟。</li>
<li>构建联盟通过<strong>核</strong>，分配利益可以用<strong>夏普利值</strong>。</li>
</ul>
<h5 id="优超"><a href="#优超" class="headerlink" title="优超"></a>优超</h5><ul>
<li>有两个联盟 $N,S$，两个条件，第一个是 $S$ 这个联盟内的成员觉得他们一起搞，$x$ 这个分配效果会比 $y$ 这个分配好，第二条条件是 $S$ 这个联盟的<strong>总</strong>收益比他们原来在 $N$ 这个联盟的<strong>分配</strong>收益更高（那么他们就有可信的威胁来不达成联盟）</li>
<li>换言之，对于可转移效用情形的合作博弈，一种分配被优超就是联盟的子联盟的收益总和大于分配给他们的总收益。定义 <strong>核</strong> 为所有不被优超的分配构成的集合。</li>
<li><p>核是一个闭凸集，满足以下两个条件</p>
<ul>
<li>$\sum x_i=V(N)$</li>
<li>$\sum _{i \in S} x_i \ge V(S);\forall S$</li>
</ul>
</li>
<li><p>常和合作博弈的核是空的。</p>
</li>
</ul>
<ul>
<li>在简单博弈中(01)，核非空的充分必要条件是存在否决权的人.</li>
</ul>
<p><strong>核</strong>关注的是分配的稳定性（而且要求太高，很多博弈没有核解），公平性用<strong>夏普利值</strong></p>
<script type="math/tex; mode=display">
\phi_i(V) = \sum_{T:i \in T \subseteq N} \frac{(t-1)!(n-t)!}{n!}\Delta_i(T)</script><script type="math/tex; mode=display">
\Delta_i(T)=V(T)-V(T-\{i\})</script><p>参与人恰好排在第 $t$ 个位置的期望收益。</p>
<hr>
<h4 id="随机博弈"><a href="#随机博弈" class="headerlink" title="随机博弈"></a>随机博弈</h4><p>带有随机性的博弈，就好比RL里出现了一点环境的随机性。</p>
<p>这部分有点复杂，这里写得很简略</p>
<h5 id="Fictitious-Play"><a href="#Fictitious-Play" class="headerlink" title="Fictitious Play"></a>Fictitious Play</h5><ul>
<li>根据对方的历史策略出的比例当成对方的概率。</li>
<li>玩家的策略最终收敛到一个稳定状态，这个稳定状态不一定是一个混合策略均衡。在实际游戏中，玩家可能不会完美地执行混合策略，或者他们可能会由于某些原因（如误解对手的意图或对自己的策略过于自信）而偏离理想的混合策略。</li>
</ul>
<h5 id="Stochastic-Games"><a href="#Stochastic-Games" class="headerlink" title="Stochastic Games"></a>Stochastic Games</h5><ul>
<li>定义在马尔可夫序列上的一个游戏，每个状态 $S$ 下有一个动作空间 $A$</li>
<li>n个人的话，$\mathcal A = A^1\times A^2 \times A^3 … \times A^n$</li>
<li><strong>关于矩阵游戏与强化学习</strong>：矩阵游戏和<strong>纳什均衡学习者</strong>更侧重于找到或收敛到一个策略，使得没有玩家有动力单方面改变策略。而强化学习和<strong>最佳响应学习者</strong>则更关注于通过不断的学习和调整策略来最大化个体收益，不一定追求均衡状态。</li>
</ul>
<p>为此关于Equilibrium Learners我们介绍三种算法</p>
<p><strong>Nash-Q</strong></p>
<p><strong>minimax-Q</strong></p>
<p><strong>Friend-or-Foe-Q</strong></p>
<hr>
<h4 id="强化学习基础"><a href="#强化学习基础" class="headerlink" title="强化学习基础"></a>强化学习基础</h4><p>关于MDP等基础此处不提，值得关注的是为什么MDP是对的，也就是为什么可以可以给出马尔可夫的假设。</p>
<p>这里面需要用到两个概念，第一个叫做占用度量。</p>
<script type="math/tex; mode=display">
\rho^{\pi}(s,a)=\mathbb E_{a \sim \pi(\cdot\mid s),s'\sim p(\cdot\mid s,a)}[\sum_{t=0}^T \gamma^tp(s_t=s,a_t=a)]</script><p>具体而言，我们得到的是</p>
<script type="math/tex; mode=display">
V=\rho^\pi \cdot R\triangleq \mathbb E_\pi[R(s,a)]</script><p>我们假设策略是平稳策略，不依赖于时间，不依赖于历史的，但是我们好像没有仔细思考过为什么可以这么假设。</p>
<blockquote>
<p>如果有了占用度量，那么我们应该是和时间无关的。</p>
</blockquote>
<p><strong>此处未严格考量</strong></p>
<p><strong>分割线</strong></p>
<hr>
<p>强化学习算法大致分成两类，值迭代和策略迭代，现代强化学习会把两者都结合起来，最早发展的是值迭代，一般认为基于bellman迭代式，方差较小，而reinforce算法是一种最基础的策略迭代……这应该没人不会了</p>
<p><strong>时序差分</strong></p>
<p>最简单的是 TD 学习方法</p>
<script type="math/tex; mode=display">
V(S_t)\leftarrow V(S_t)+\alpha(R_{t+1}+\gamma V(S_{t+1})-V(S_t))</script><p>累计奖励（一般用于蒙特卡洛）$G<em>t=R</em>{t+1}+\gamma R_{t+2}+…+\gamma^{T-1}R_T$  是 $V^\pi(S_t)$ 的无偏估计</p>
<p>时序差分的<strong>真实目标</strong> $R<em>{t+1}+V^\pi(S</em>{t+1})$ 是无偏估计。</p>
<p>时序差分的<strong>目标</strong> $R<em>{t+1}+V(S</em>{t+1})$ 则是有偏估计。（但是它方差小啊）</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>MC</th>
<th>TD</th>
<th>DP</th>
</tr>
</thead>
<tbody>
<tr>
<td>无偏估计，高方差</td>
<td>低方差，有偏差</td>
<td>你不知道未来</td>
</tr>
<tr>
<td>良好的收敛性质 • 使用函数近似时依然如此</td>
<td>时序差分最终收敛到但使用函数近似并不总是如此</td>
<td>你不知道未来</td>
</tr>
<tr>
<td>对初始值不敏感</td>
<td>比蒙特卡洛对初始值更加敏感</td>
<td>你不知道未来</td>
</tr>
</tbody>
</table>
</div>
<p><strong>value-&gt;policy</strong>：在上面这个迭代方法中，我们能得到value，只需要再加上小小的一点点就能得到policy，即argmax.</p>
<script type="math/tex; mode=display">
\pi(s)=\arg \max_{a\in A} Q(s,a)</script><p>所以学Q也是可以的，Q就是多了一步</p>
<p>一个叫<strong>SARSA</strong>的算法的Q公式是这样的：</p>
<script type="math/tex; mode=display">
Q(s,a)\leftarrow Q(s,a)+\alpha (r+\gamma Q(s',a')-Q(s,a))</script><p>SARSA是<strong>在线</strong>的，因为在这之后它就需要根据Q继续采样，它的采样策略称为 $\epsilon$-greedy，一定概率随机探索，一定概率取best action</p>
<p>如果考虑<strong>离线</strong>的学习方法，可以把SARSA改一改，就是在update的时候取的 $a’$ 因为不能探索所以只是通过argmax得到，这就是我们熟知的Q-learning。</p>
<p><strong>TD(λ)</strong>：很显然我们只通过一步迭代可能会有点方差还是大了一点，在实践中往往用多步时序差分，定义</p>
<script type="math/tex; mode=display">
G_t^{(n)}=R_{t+1}+\gamma R_{t+2}+...+\gamma^{n-1}R_{t+n}+\gamma^n V(S_{t+n})</script><script type="math/tex; mode=display">
G_t^{\lambda }=(1-\lambda) \sum_{n=1}^\infin \lambda^{n-1} G_t^{(n)}</script><p>就是用平均 $n$ 步累计奖励来做，TD(λ)可以用类似dp的方法倒推求，后面写GAE的时候再补充这里，<strong>为什么要求均值</strong>，因为方差会减小。</p>
<p>所以TD lambda这里就是利用 $G_{t}^\lambda$ 来更新其值函数。下面有一些新的概念</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/402198744">【Typical RL 13】GAE - 知乎 (zhihu.com)</a></p>
<p>定义 $\lambda $ Return就是 $G_t^{\lambda}-V(S_t)$，经过一些推导可以发现</p>
<script type="math/tex; mode=display">
G_t^{\lambda}-V(S_t)=\sum_{k \ge 1} (\lambda \gamma)^{k-1}\delta_{t+k}</script><p>其中</p>
<script type="math/tex; mode=display">
\delta_{t+k}=R_{t+k}+\lambda V(S_{t+k})-V(S_{t+k-1})</script><p>回到这里，我们思考一下会发现 $\lambda$ 越大，就越像TD，越小就越像MC。</p>
<p>回到上文，这里引出一个概念就是 $A(s,t)=Q(s,t)-V(s)$，对于策略梯度来说 $A$ 是无偏估计，因为 $V$ 与 $\pi$ 无关，求导后是零。</p>
<script type="math/tex; mode=display">
A(s_t,a_t)=Q(s_t,a_t)-V(s_t)=E_{s_{t+1}}[r_t + \gamma V(S_{t+1} )\mid S_t=s] - V(s)=E_{S_{t+1}}[\delta_t]</script><p><strong>可以用TD-error作为Advantage函数的估计量</strong>。</p>
<p>人们后来又发现 GAE 也可以就是 $\lambda$ Return的方法加权求和，所以用 GAE 来估计 advantage function是很恰当的事情。</p>
<p><a target="_blank" rel="noopener" href="https://anyscale-ray-doc-assets.s3-us-west-2.amazonaws.com/_modules/ray/rllib/evaluation/postprocessing.html">ray.rllib.evaluation.postprocessing — Ray v0.9.0.dev0 (anyscale-ray-doc-assets.s3-us-west-2.amazonaws.com)</a></p>
<p>关于怎么求GAE，Eligibility Traces可以用，直接看代码很好理解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_advantages</span>(<span class="params">rewards, next_done, dones, values, last_value, args</span>):</span></span><br><span class="line">    advantages = torch.zeros_like(rewards).to(args.device)</span><br><span class="line">    lastgaelam = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(args.num_steps)):</span><br><span class="line">        <span class="keyword">if</span> t == args.num_steps - <span class="number">1</span>:</span><br><span class="line">            nextnonterminal = <span class="number">1.0</span> - next_done</span><br><span class="line">            nextvalues = last_value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nextnonterminal = <span class="number">1.0</span> - dones[t + <span class="number">1</span>]</span><br><span class="line">            nextvalues = values[t + <span class="number">1</span>]</span><br><span class="line">        delta = rewards[t] + args.gamma * nextvalues * nextnonterminal - values[t]</span><br><span class="line">        advantages[t] = lastgaelam = delta + args.gamma * args.gae_lambda * nextnonterminal * lastgaelam</span><br><span class="line">    <span class="keyword">return</span> advantages</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>第一行就是初始化一个gae，然后根据step倒着来，中间大概是说如果是路径结束可以是得到的准确值，否则就是V这个估计值。</p>
<p>注意看先求出了delta，然后计算了advantage的衰减，至于我这里其实计算了好多组advantage，是不同起点出发的路径。</p>
<p>同样的，我们可以用 <strong>神经网络</strong> 来充当这个Q，以及policy的近似器。</p>
<p>回到 <strong>DQN</strong>，很明显需要两个网络，一个是目标的Q，一个是目前在学的预测的Q。</p>
<p>所谓的 DoubleQ，就是我在选取action用一个Q网络，选完action后估计它的值用另一个Q网络（target）。【更新q_target】</p>
<blockquote>
<p>doubleDQN中有重要性采样，但是这一步我没看懂为什么要用重要性采样，似乎是为了把在线变离线？</p>
</blockquote>
<hr>
<h4 id="策略梯度法"><a href="#策略梯度法" class="headerlink" title="策略梯度法"></a>策略梯度法</h4><p>策略梯度定理</p>
<script type="math/tex; mode=display">
\frac{\partial J(\theta)}{\partial \theta}=\mathbb E_{\pi _\theta}\left[\frac{\partial \log \pi _{\theta}(a\mid s)}{\partial \theta} Q^{\pi_\theta}(s,a)\right]</script><p>这里就放一个结论：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/491647161">https://zhuanlan.zhihu.com/p/491647161</a></p>
<script type="math/tex; mode=display">
J(\pi) =\mathbb E\left[\sum_{t=1}^\infty \gamma^{t-1} r_t \mid s_0,\pi\right]\\
\frac{\partial J(\pi)}{\partial \theta}=\frac{\partial V^{\pi}(s_0)}{\partial \theta}=\sum_s d^{\pi}(s)\sum_a \frac{\partial \pi(s,a)}{\partial \theta} Q^{\pi}(s,a)\\
=\sum_s d^{\pi}(s)\sum_a \pi(s,a)\nabla_{\theta} \ln \pi(s,a) Q^{\pi}(s,a)\\
=\mathbb E_{s\sim D^\pi,a\sim \pi(a\mid s)}[q(s,a) \nabla \ln \pi (a\mid s)]</script><p>这里 $d^{\pi}(s)$ 意思是状态 $s$ 在 $s_0$ 出发的轨迹中出现的期望次数，如果带discont严格意义上是有偏估计。</p>
<p>策略梯度的另一个思考方法假设有N条路径，是直接对 $\tau$ 的期望来求导，可以得到的大约是</p>
<script type="math/tex; mode=display">
\nabla_{\theta} J(\theta)\approx\frac{1}{N} \sum _{i=1}^N (\sum_{t=1}^T\nabla _{\theta} \log \pi_\theta(a_{it}\mid s_{it})(\sum_{i=1}^T r(s_{it},a_{it})))</script><p><strong>至于为什么这个理解下这两个是分开的，我还没搞明白</strong></p>
<p>如果使用softmax的随机策略，也即</p>
<script type="math/tex; mode=display">
\pi_\theta(a\mid s)=\frac{e^{f_\theta(s,a)}}{\sum ...}</script><p>那么求对数之后求导就是 $f$ 的导数减去 $f$ 的导数关于 $a’$ 的期望。</p>
<hr>
<p>于是我们引出了 <strong>Reinforce</strong> 算法，这是一个MC的算法，方差很大，所以我们想能不能引入TD的方法：那么引入 $\pi $ 和 $Q$ 两个网络就是一个新的算法。如果想用上文提到的Advantage来更新critic网络也是可以的，值得注意的是Advantage Function可以直接取代Q作为policy gradient的参数，依然是无偏估计而且能降低方差。</p>
<p>关于引入深度学习，在形式上深度强化学习和强化学习没有差别，只是一个参数 $\theta$。算法 A3C 是算法 A2C 的异步形式，异步地积累梯度，然后定时同步。</p>
<p><strong>这里跳过了一些Actor-Critic的介绍</strong>，如果读者不是很熟悉，<strong>强烈推荐</strong>这个： <a target="_blank" rel="noopener" href="https://spinningup.openai.com/en/latest。">https://spinningup.openai.com/en/latest。</a></p>
<p><strong>确定性策略梯度算法</strong></p>
<p>引入一个算法叫DPG（ICML2014），深度网络版本叫DDPG。</p>
<p><a target="_blank" rel="noopener" href="https://spinningup.openai.com/en/latest/algorithms/ddpg.html">Deep Deterministic Policy Gradient — Spinning Up documentation (openai.com)</a></p>
<p>其实算法是一样的，但是连续动作所以不是采样，而是直接 $a=\pi_\theta(s)$，直接导致这个 $a$ 是可微的，也就可以从后一个状态梯度反传到前一个状态。</p>
<p>也就是说，直接通过链式法则得出：</p>
<script type="math/tex; mode=display">
\nabla_{\theta}J(\pi _\theta)=\mathbb E_{s \sim \rho^\pi}\left[\nabla _{\theta} \pi_{\theta}(s)\nabla _aQ^w(s,a) \mid _{a =\pi_\theta(s)}\right]</script><p>虽然在严谨的推导过程中它其实是<strong>丢掉了一项</strong>，只不过在策略更新小的情况下那一项被扔掉是可以接受的。</p>
<p>但是它只能是offline版本，因为引入噪声才行。</p>
<p>DDPG的tricks包括：经验回放（离线策略），目标网络，在动作输入前批标准化Q网络，添加连续噪声，最后终于把它搞work了。——广泛应用于机器人控制领域。</p>
<p>接下来我们考虑 <strong>off-policy</strong> 的策略梯度，因为学习的和采样的是不同的策略，所以就需要用到重要性采样了。</p>
<p><strong>TD3</strong>算法，Twin Delayed DDPG，是用了三个trick，两个Q函数，不同的policy和Q的更新速度，目标函数增加高斯噪声。</p>
<hr>
<h5 id="Stochastic-Value-gradient"><a href="#Stochastic-Value-gradient" class="headerlink" title="Stochastic Value gradient"></a>Stochastic Value gradient</h5><blockquote>
<p><strong>Deep RL Bootcamp 2017, Lecture 7</strong></p>
<p>Learning Continuous control policies by stochastic value gradients. NIPS 2015</p>
</blockquote>
<p>这里也先跳过吧，有点难。</p>
<hr>
<h5 id="natural-policy-gradient"><a href="#natural-policy-gradient" class="headerlink" title="natural policy gradient"></a>natural policy gradient</h5><blockquote>
<p><strong>Natural Actor-Critic</strong>, Jan Peters</p>
</blockquote>
<p><strong>covariant view</strong>：我们希望梯度是放射变化无关的，于是需要给梯度乘上一个系数，使得原来关于参数 $\theta$ 的梯度方向乘上系数和关于变换后的 $h$ 参数的梯度（关于 $\theta$ 的情况）一样。</p>
<p>理论上来说 $\nabla <em>h J(h)=\nabla _h\theta \nabla </em>\theta J(\theta)$。现在我们考察Fisher Information Matrix，我们定义了从参数 $\theta$ 变成参数 $h$ 的一个变换，这个Fisher Information Matrix满足性质是：</p>
<script type="math/tex; mode=display">
F(h)=\nabla_h \theta F(\theta)\nabla_h \theta^T</script><p>这个Fisher Information Matrix有点类似于Hessian，但是score function，就是先对策略 $\pi$ 取了一个对数，然后最后求期望。总之，假设存在这样一个函数 $F$ 满足上面的变换性质，我们就有</p>
<script type="math/tex; mode=display">
\tilde \nabla_h J(h)=F^{-1}(h)\nabla _h J(h)=(\nabla_h \theta F(\theta)\nabla_h \theta^T)^{-1}\nabla_h \theta \nabla _\theta J(\theta)\\</script><script type="math/tex; mode=display">
\nabla_h \theta^T\tilde \nabla _h J(h)=\tilde \nabla_\theta J(\theta)</script><p>注意看这个形式和之前直接链式法则还是不太一样的，这个能让我们导出</p>
<script type="math/tex; mode=display">
\Delta \theta =\alpha \nabla _h\theta^T \Delta h=\alpha \nabla_h \theta^T\tilde \nabla _h J(h)=\alpha \tilde \nabla_\theta J(\theta)</script><p>也就是虽然在 $h$ 下做这个参数 $\alpha$ 的梯度，在 $\theta$ 下也是这个梯度。</p>
<p><strong>Optimisation View</strong>：注意牛顿法每次找二次拟合曲线的最低点，牛顿法是仿射不变的。</p>
<p><strong>Compatible point of view</strong>：</p>
<p>如果存在一个 $Q$，作为近似</p>
<script type="math/tex; mode=display">
Q_w(s,a) \approx Q^{\pi_\theta}(s,a)</script><p>满足两个条件：</p>
<script type="math/tex; mode=display">
\nabla _w Q_w(s,a) = \nabla _\theta \log \pi_\theta (s,a)\\
\epsilon = \mathbb E_\pi \left[[(Q^{\pi_\theta}(s,a)-Q_w(s,a)]^2\right]</script><p>然后最小化这个 $\epsilon$，这样的情况下estimator是无偏的。</p>
<p>可以看 Compatible Function Approximator Theorem，<a target="_blank" rel="noopener" href="https://web.stanford.edu/class/cme241/lecture_slides/PolicyGradient.pdf">PolicyGradient.pdf (stanford.edu)</a>后面有证明。个人认为理解这里的Q可以用soft max的想法。</p>
<p>这时候</p>
<script type="math/tex; mode=display">
\nabla_\theta J(\theta) = \mathbb E_{\pi _\theta}\left[\nabla_\theta \log \pi_\theta(s,a) Q_w(s,a)\right]</script><p>可以直接展开。</p>
<hr>
<h4 id="TRPO"><a href="#TRPO" class="headerlink" title="TRPO"></a>TRPO</h4><blockquote>
<p>务必掌握每个公式！</p>
</blockquote>
<script type="math/tex; mode=display">
\delta(P,Q) \le \sqrt{\frac{1}{2} D_{KL}(P||Q)}</script><p>这个意思是Total Variation可以被KL给bound住。</p>
<p>我要找到最小的地方：</p>
<script type="math/tex; mode=display">
J(\theta')-J(\theta)=\mathbb E_{\tau \sim p_{\theta'}(\tau)}\left[\sum_ t \gamma^t A^{\pi_\theta}(s_t,a_t)\right]</script><p>然后期中复习到这里，下面这个考了这个推导我没整出来，感觉自己好菜。</p>
<script type="math/tex; mode=display">
J(\theta')-J(\theta)=J(\theta')-\mathbb E_{s_0 \sim p(s_0)}\left[V^{\pi_\theta}(s_0)\right]\\
=J(\theta') - \mathbb E_{\tau\sim p_{\theta'}(\tau)}\left[V^{\pi_\theta}\\
(s_0)\right]\\
=J(\theta') - \mathbb E_{\tau\sim p_{\theta'}(\tau)}\left[\sum_{t=0}^{\infty} \gamma^tV^{\pi_\theta}\\
(s_t)-\sum_{t=1}^{\infty} \gamma^tV^{\pi_\theta}\\
(s_t)\right]\\
=J(\theta') - \mathbb E_{\tau\sim p_{\theta'}(\tau)}\left[\sum_{t=0}^{\infty} \gamma^t(\gamma V^{\pi_\theta}(s_{t+1})-V^{\pi_\theta}\\
(s_t))\right]\\
=\mathbb E_{\tau\sim p_{\theta'}(\tau)}\left[\sum_{t=0}^{\infty} \gamma^t(r(s_t,a_t)+\gamma V^{\pi_\theta}(s_{t+1})-V^{\pi_\theta}\\
(s_t))\right]\\
=\mathbb E_{\tau\sim p_{\theta'}(\tau)}\left[\sum_{t=0}^{\infty} \gamma^tA^{\pi_{\theta}}(s_t,a_t)\right]\\</script><hr>
<p>More to be done</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://emoairx.github.io/blog/2024/05/04/note%20on%20multiAgent/" title="博弈论与强化学习の期中复习" target="_blank" rel="external">http://emoairx.github.io/blog/2024/05/04/note on multiAgent/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/blog/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">emoairx</span><small class="ml-1x">PKU,EECS</small></a></h3>
        <div>春天来了，冬天还会远吗~</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/blog/2024/05/04/diary/diary240504/" title="240504"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/blog/2024/05/01/diary/diary240501/" title="240501"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/emoairx" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/blog/js/plugin.min.js"></script>


<script src="/blog/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/blog/',
        CONTENT_URL: '/blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/blog/js/insight.js"></script>






   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: 'AONthdWWfk53xtyouAX8NhIf-gzGzoHsz',
    appKey: '7lxwWP9F0g0a68t0qEPsTFR9',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: true
  });
  </script>

     







<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>